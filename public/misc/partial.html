<!-- vim: set nomodeline: -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>/home/krone/Development/ghostty-shader-playground/server.js</title>
<meta name="colorscheme" content="catppuccin-mocha"></meta>
<style>
* {font-family: monospace; font-size: 17px; line-height: 18px;}
body {background-color: #0b0e14; color: #c1c9e6; margin: 0;}
.Number {color: #fab770}
.-constructor {color: #faca64}
.Conditional {color: #ff8f40; font-style: italic}
.-string-regexp {color: #fab770}
.DiagnosticUnderlineHint {text-decoration-line: underline; text-decoration-color: #4cd4bd}
.String {color: #70cf67}
.-ibl-scope-underline-1 {text-decoration-line: underline; text-decoration-color: #c1c9e6}
.Type {color: #faca64}
.-keyword-operator {color: #ff8f40}
.Constant {color: #fab770}
.-spell {}
.-keyword-return {color: #ff8f40}
.Exception {color: #ff8f40}
.-ibl-whitespace-char-1 {color: #2f313d}
.-string-escape {color: #ad6ff7}
.Function {color: #00bfff}
.LspReferenceRead {background-color: #2f313d}
.Repeat {color: #ff8f40}
.Comment {color: #7d8296; font-style: italic}
.-variable {color: #c1c9e6}
.-ibl-scope-char-1 {color: #c1c9e6}
.-variable-builtin {color: #e66767}
.-type-builtin {color: #ff8f40}
.-variable-parameter {color: #eb788b}
.Keyword {color: #ff8f40}
.-ibl-indent-char-1 {color: #1d1e29}
.Special {color: #ad6ff7}
.-keyword-function {color: #ff8f40}
.Delimiter {color: #7d8296}
.-punctuation-bracket {color: #7d8296}
.-none {}
.-variable-member {color: #c1c9e6}
.Boolean {color: #fab770}
.-function-builtin {color: #fab770}
.Operator {color: #61bdff}
</style>
</head>
<body style="display: flex">
<pre>
<span class="-keyword-function">function</span> <span class="-variable"><span class="Function">watchDirectoryRecursively</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="-variable-parameter">dirPath</span></span><span class="Delimiter">,</span> <span class="-variable"><span class="-variable-parameter">depth</span></span> <span class="Operator">=</span> <span class="Number">0</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">fs</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">watch</span></span><span class="-punctuation-bracket">(</span><span class="-variable">dirPath</span><span class="Delimiter">,</span> <span class="-punctuation-bracket">(</span><span class="-variable"><span class="-variable-parameter"><span class="Comment">event</span></span></span><span class="Delimiter">,</span> <span class="-variable"><span class="-variable-parameter">filename</span></span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Conditional">if</span> <span class="-punctuation-bracket">(</span><span class="Operator">!</span><span class="-variable">filename</span><span class="-punctuation-bracket">)</span> <span class="-keyword-return">return</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Comment"><span class="-spell">// ignore changes from tmp files ?</span></span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Conditional">if</span> <span class="-punctuation-bracket">(</span><span class="Operator">!</span><span class="-variable">filename</span> <span class="Operator">||</span> <span class="-variable">filename</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">endsWith</span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;~&quot;</span><span class="-punctuation-bracket">)</span> <span class="Operator">||</span> <span class="-punctuation-bracket">/</span><span class="-string-regexp">^\d+$</span><span class="-punctuation-bracket">/</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">test</span></span><span class="-punctuation-bracket">(</span><span class="-variable">filename</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">)</span> <span class="-keyword-return">return</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="Function">clearTimeout</span></span><span class="-punctuation-bracket">(</span><span class="-variable">reloadTimer</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">reloadTimer</span> <span class="Operator">=</span> <span class="-variable"><span class="Function">setTimeout</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="-variable-builtin">console</span></span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">log</span></span><span class="-punctuation-bracket">(</span><span class="String">`<span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable">performance</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">now</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span> <span class="Operator">/</span> <span class="Number">1000</span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>[<span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable">depth</span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>] Changed: <span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable">filename</span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>`</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Conditional">if</span> <span class="-punctuation-bracket">(</span><span class="-variable">filename</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">endsWith</span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;.glsl&quot;</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="Function">broadcastReloadShader</span></span><span class="-punctuation-bracket">(</span><span class="-variable">filename</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span> <span class="Conditional">else</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="Function"><span class="Function">broadcastReload</span></span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span><span class="Delimiter">,</span> <span class="Number">10</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Exception">try</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Keyword">const</span> <span class="-variable">entries</span> <span class="Operator">=</span> <span class="-variable">fs</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">readdirSync</span></span><span class="-punctuation-bracket">(</span><span class="-variable">dirPath</span><span class="Delimiter">,</span> <span class="-punctuation-bracket">{</span> <span class="-variable-member">withFileTypes</span><span class="Delimiter">:</span> <span class="Boolean">true</span> <span class="-punctuation-bracket">}</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Repeat">for</span> <span class="-punctuation-bracket">(</span><span class="Keyword">const</span> <span class="-variable">entry</span> <span class="Repeat">of</span> <span class="-variable">entries</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Conditional">if</span> <span class="-punctuation-bracket">(</span><span class="-variable">entry</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">isDirectory</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Keyword">const</span> <span class="-variable">subDirPath</span> <span class="Operator">=</span> <span class="-variable">path</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">join</span></span><span class="-punctuation-bracket">(</span><span class="-variable">dirPath</span><span class="Delimiter">,</span> <span class="-variable">entry</span><span class="Delimiter">.</span><span class="-variable-member">name</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="Function">watchDirectoryRecursively</span></span><span class="-punctuation-bracket">(</span><span class="-variable">subDirPath</span><span class="Delimiter">,</span> <span class="-variable">depth</span> <span class="Operator">+</span> <span class="Number">1</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span> <span class="Exception">catch</span> <span class="-punctuation-bracket">(</span><span class="-variable">err</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="-variable-builtin">console</span></span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">error</span></span><span class="-punctuation-bracket">(</span><span class="String">`Error reading directory <span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable">dirPath</span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>:`</span><span class="Delimiter">,</span> <span class="-variable">err</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span>
<span class="-punctuation-bracket">}</span>

<span class="-variable"><span class="Function">watchForChanges</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>

<span class="-variable">server</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">listen</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="Type"><span class="Constant">PORT</span></span></span><span class="Delimiter">,</span> <span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="-variable-builtin">console</span></span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">log</span></span><span class="-punctuation-bracket">(</span><span class="String">`Server running at http://localhost:<span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable"><span class="Type"><span class="Constant">PORT</span></span></span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>`</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Conditional">if</span> <span class="-punctuation-bracket">(</span><span class="-variable">shouldOpenBrowser</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Keyword">const</span> <span class="-punctuation-bracket">{</span> <span class="-variable">exec</span> <span class="-punctuation-bracket">}</span> <span class="Operator">=</span> <span class="-variable"><span class="Function"><span class="-function-builtin">require</span></span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;child_process&quot;</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Keyword">const</span> <span class="-variable">url</span> <span class="Operator">=</span> <span class="String">`http://localhost:<span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable"><span class="Type"><span class="Constant">PORT</span></span></span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>`</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Keyword">const</span> <span class="-variable">commands</span> <span class="Operator">=</span> <span class="-punctuation-bracket">[</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="String">&quot;xdg-open&quot;</span><span class="Delimiter">,</span> <span class="Comment"><span class="-spell">// Linux</span></span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="String">&quot;open&quot;</span><span class="Delimiter">,</span> <span class="Comment"><span class="-spell">// macOS</span></span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="String">&quot;start&quot;</span><span class="Delimiter">,</span> <span class="Comment"><span class="-spell">// Windows</span></span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">]</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Keyword">let</span> <span class="-variable">commandIndex</span> <span class="Operator">=</span> <span class="Number">0</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Keyword">const</span> <span class="-variable"><span class="Function">tryOpenBrowser</span></span> <span class="Operator">=</span> <span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Conditional">if</span> <span class="-punctuation-bracket">(</span><span class="-variable">commandIndex</span> <span class="Operator">&gt;=</span> <span class="-variable">commands</span><span class="Delimiter">.</span><span class="-variable-member">length</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="-variable-builtin">console</span></span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">log</span></span><span class="-punctuation-bracket">(</span><span class="String">`Please open your browser and navigate to: <span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable">url</span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>`</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-keyword-return">return</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Keyword">const</span> <span class="-variable">command</span> <span class="Operator">=</span> <span class="-variable">commands</span><span class="-punctuation-bracket">[</span><span class="-variable">commandIndex</span><span class="-punctuation-bracket">]</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="Function">exec</span></span><span class="-punctuation-bracket">(</span><span class="String">`<span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable">command</span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span> <span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable">url</span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>`</span><span class="Delimiter">,</span> <span class="-punctuation-bracket">(</span><span class="-variable"><span class="-variable-parameter">error</span></span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Conditional">if</span> <span class="-punctuation-bracket">(</span><span class="-variable">error</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">commandIndex</span><span class="Operator">++</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="Function">tryOpenBrowser</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span> <span class="Conditional">else</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="-variable-builtin">console</span></span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">log</span></span><span class="-punctuation-bracket">(</span><span class="String">`Browser opened: <span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable">url</span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>`</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Comment"><span class="-spell">// wait a moment for the server to be ready</span></span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="Function">setTimeout</span></span><span class="-punctuation-bracket">(</span><span class="-variable">tryOpenBrowser</span><span class="Delimiter">,</span> <span class="Number">500</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span>
<span class="-punctuation-bracket">}</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>

<span class="Keyword">let</span> <span class="-variable">isShuttingDown</span> <span class="Operator">=</span> <span class="Boolean">false</span><span class="Delimiter">;</span>

<span class="-keyword-function">function</span> <span class="-variable"><span class="Function">gracefulShutdown</span></span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="-variable-parameter">signal</span></span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Conditional"><span class="-ibl-scope-underline-1">if</span></span><span class="-ibl-scope-underline-1"> <span class="-punctuation-bracket">(</span><span class="-variable">isShuttingDown</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span></span><span class="-punctuation-bracket"></span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-scope-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-keyword-return">return</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span>
<span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">isShuttingDown</span> <span class="Operator">=</span> <span class="Boolean">true</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="-variable-builtin">console</span></span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">log</span></span><span class="-punctuation-bracket">(</span><span class="String">`<span class="-string-escape">\n</span>Received <span class="-none"><span class="-none"><span class="Special">${</span><span class="-variable">signal</span><span class="-punctuation-bracket"><span class="Special">}</span></span></span></span>. Shutting down gracefully...`</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">wss</span><span class="Delimiter">.</span><span class="-variable-member">clients</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">forEach</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">(</span><span class="-variable"><span class="-variable-parameter">client</span></span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="Conditional">if</span> <span class="-punctuation-bracket">(</span><span class="-variable">client</span><span class="Delimiter">.</span><span class="-variable-member">readyState</span> <span class="Operator">===</span> <span class="-variable"><span class="Type">WebSocket</span></span><span class="Delimiter">.</span><span class="-variable-member">OPEN</span><span class="-punctuation-bracket">)</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">client</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">close</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">wss</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">close</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="-variable-builtin">console</span></span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">log</span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;WebSocket server closed&quot;</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">server</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">close</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="-variable-builtin">console</span></span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">log</span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;HTTP server closed&quot;</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">process</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">exit</span></span><span class="-punctuation-bracket">(</span><span class="Number">0</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="Function">setTimeout</span></span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-punctuation-bracket">{</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable"><span class="-variable-builtin">console</span></span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">log</span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;Force closing server...&quot;</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-variable">process</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">exit</span></span><span class="-punctuation-bracket">(</span><span class="Number">1</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-ibl-indent-char-1">▎</span><span class="-ibl-whitespace-char-1"> </span><span class="-punctuation-bracket">}</span><span class="Delimiter">,</span> <span class="Number">3000</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-punctuation-bracket">}</span>

<span class="-variable">process</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">on</span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;SIGINT&quot;</span><span class="Delimiter">,</span> <span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-variable"><span class="Function">gracefulShutdown</span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;SIGINT&quot;</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>
<span class="-variable">process</span><span class="Delimiter">.</span><span class="-variable-member"><span class="Function">on</span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;SIGTERM&quot;</span><span class="Delimiter">,</span> <span class="-punctuation-bracket">(</span><span class="-punctuation-bracket">)</span> <span class="Operator">=&gt;</span> <span class="-variable"><span class="Function">gracefulShutdown</span></span><span class="-punctuation-bracket">(</span><span class="String">&quot;SIGTERM&quot;</span><span class="-punctuation-bracket">)</span><span class="-punctuation-bracket">)</span><span class="Delimiter">;</span>

</pre>
</body>
</html>

